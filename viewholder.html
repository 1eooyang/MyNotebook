<!DOCTYPE HTML>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="Keywords" content="blog"/>
    <meta name="Description" content="blog"/>
    <title>Simple</title>
    <link rel="shortcut icon" href="/static/favicon.png"/>
    <link rel="stylesheet" type="text/css" href="/main.css" />
</head>
<body>
<div class="main">
    <div class="header">
    	<ul id="pages">
            <li><a href="/">home</a></li>
            <li><a href="/#/tags">tags</a></li>
            <li><a href="/#/archive">archive</a></li>
    	</ul>
    </div>
	<div class="wrap-header">
	<h1>
    <a href="/" id="title"></a>
	</h1>
	</div>
<div id="md" style="display: none;">
<!-- markdown -->
#<center>优化listview的viewholder模式</center>
使用Adapter填充ListView中数据的时候，getView方法每次都会调用findViewById的方法来实例化每个item中的组件。也就是说，ListView中有多少个item，item里面的组件就会被实例化多少次。这明显会增加ListView的内存占用。而使用ViewHolder来优化adapter可以大大提高ListView的效率。

使用ListView也很简单，只要在自定义的Adapter中，定义一个内部类ViewHolder，然后把cell中出现的组件作为其成员变量就可以了。一个具体的adapter例子的代码如下所示。
~~~~{java}
package com.bboylin.sportsmeeting.Adapter;

import android.content.Context;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.BaseAdapter;
import android.widget.TextView;

import com.bboylin.sportsmeeting.Item.NewsItem;
import com.bboylin.sportsmeeting.R;

import java.util.List;

/**
 * Created by lin on 2016/3/29.
 */
public class NewsAdapter extends BaseAdapter{
    private LayoutInflater mInflater;
    private List<NewsItem> newsItemList;
    public NewsAdapter(Context context,List<NewsItem> list){
        this.newsItemList=list;
        this.mInflater=LayoutInflater.from(context);
    }
    @Override
    public int getCount() {
        if(newsItemList!=null){
            return newsItemList.size();
        }
        return 0;
    }

    @Override
    public Object getItem(int position) {
        return newsItemList.get(position);
    }

    @Override
    public long getItemId(int position) {
        return position;
    }

    @Override
    public View getView(int position, View convertView, ViewGroup parent) {
        ViewHolder holder = null;
        NewsItem newsItem=newsItemList.get(position);
        if (convertView == null){
            holder = new ViewHolder();
            //通过LayoutInflater实例化布局
            convertView = mInflater.inflate(R.layout.news_item, null);
            holder.titleTextview= (TextView) convertView.findViewById(R.id.news_titleTextview);
            holder.timeTextview= (TextView) convertView.findViewById(R.id.news_timeTextview);
            convertView.setTag(holder);
        }else {
            //通过tag找到缓存的布局
            holder = (ViewHolder) convertView.getTag();
        }
        holder.titleTextview.setText(newsItem.getNewstitle());
        holder.timeTextview.setText(newsItem.getNewstime());
        return convertView;
    }

    public final class ViewHolder{
        public TextView titleTextview;
        public TextView timeTextview;
    }
}

~~~~
这样就可以通过adapter的构造方法来填充自己的数据。
~~~~{java}
mAdapter=new NewsAdapter(this.getActivity(),mNewsList);
~~~~
这样，就可以实现ListView的效果了。 

reference：[http://blog.csdn.net/futureshine1/article/details/50822605](http://blog.csdn.net/futureshine1/article/details/50822605)

更多博客尽在：[bboylin.com](http://bboylin.com)
<!-- markdown end -->
</div>
<div class="entry" id="main">
<!-- content -->
<h1 id="centerlistviewviewholdercenter"><center>优化listview的viewholder模式</center></h1>

<p>使用Adapter填充ListView中数据的时候，getView方法每次都会调用findViewById的方法来实例化每个item中的组件。也就是说，ListView中有多少个item，item里面的组件就会被实例化多少次。这明显会增加ListView的内存占用。而使用ViewHolder来优化adapter可以大大提高ListView的效率。</p>

<p>使用ListView也很简单，只要在自定义的Adapter中，定义一个内部类ViewHolder，然后把cell中出现的组件作为其成员变量就可以了。一个具体的adapter例子的代码如下所示。
</p><pre class=" language-java"><code class=" language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>bboylin<span class="token punctuation">.</span>sportsmeeting<span class="token punctuation">.</span>Adapter<span class="token punctuation">;</span>

<span class="token keyword">import</span> android<span class="token punctuation">.</span>content<span class="token punctuation">.</span>Context<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>LayoutInflater<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>View<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>ViewGroup<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>BaseAdapter<span class="token punctuation">;</span>
<span class="token keyword">import</span> android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>TextView<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>bboylin<span class="token punctuation">.</span>sportsmeeting<span class="token punctuation">.</span>Item<span class="token punctuation">.</span>NewsItem<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>bboylin<span class="token punctuation">.</span>sportsmeeting<span class="token punctuation">.</span>R<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * Created by lin on 2016/3/29.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NewsAdapter</span> <span class="token keyword">extends</span> <span class="token class-name">BaseAdapter</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> LayoutInflater mInflater<span class="token punctuation">;</span>
    <span class="token keyword">private</span> List<span class="token operator">&lt;</span>NewsItem&gt; newsItemList<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">NewsAdapter<span class="token punctuation">(</span></span>Context context<span class="token punctuation">,</span>List<span class="token operator">&lt;</span>NewsItem&gt; list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>newsItemList<span class="token operator">=</span>list<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mInflater<span class="token operator">=</span>LayoutInflater<span class="token punctuation">.</span><span class="token function">from<span class="token punctuation">(</span></span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    @Override
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCount<span class="token punctuation">(</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>newsItemList<span class="token operator">!</span><span class="token operator">=</span>null<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> newsItemList<span class="token punctuation">.</span><span class="token function">size<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token number"> 0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

@Override
<span class="token keyword">public</span> Object <span class="token function">getItem<span class="token punctuation">(</span></span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> newsItemList<span class="token punctuation">.</span><span class="token function">get<span class="token punctuation">(</span></span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@Override
<span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getItemId<span class="token punctuation">(</span></span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@Override
<span class="token keyword">public</span> View <span class="token function">getView<span class="token punctuation">(</span></span><span class="token keyword">int</span> position<span class="token punctuation">,</span> View convertView<span class="token punctuation">,</span> ViewGroup parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ViewHolder holder <span class="token operator">=</span> null<span class="token punctuation">;</span>
    NewsItem newsItem<span class="token operator">=</span>newsItemList<span class="token punctuation">.</span><span class="token function">get<span class="token punctuation">(</span></span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>convertView <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{</span>
        holder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment" spellcheck="true"> //通过LayoutInflater实例化布局
</span>        convertView <span class="token operator">=</span> mInflater<span class="token punctuation">.</span><span class="token function">inflate<span class="token punctuation">(</span></span>R<span class="token punctuation">.</span>layout<span class="token punctuation">.</span>news_item<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
        holder<span class="token punctuation">.</span>titleTextview<span class="token operator">=</span> <span class="token punctuation">(</span>TextView<span class="token punctuation">)</span> convertView<span class="token punctuation">.</span><span class="token function">findViewById<span class="token punctuation">(</span></span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>news_titleTextview<span class="token punctuation">)</span><span class="token punctuation">;</span>
        holder<span class="token punctuation">.</span>timeTextview<span class="token operator">=</span> <span class="token punctuation">(</span>TextView<span class="token punctuation">)</span> convertView<span class="token punctuation">.</span><span class="token function">findViewById<span class="token punctuation">(</span></span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>news_timeTextview<span class="token punctuation">)</span><span class="token punctuation">;</span>
        convertView<span class="token punctuation">.</span><span class="token function">setTag<span class="token punctuation">(</span></span>holder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
       <span class="token comment" spellcheck="true"> //通过tag找到缓存的布局
</span>        holder <span class="token operator">=</span> <span class="token punctuation">(</span>ViewHolder<span class="token punctuation">)</span> convertView<span class="token punctuation">.</span><span class="token function">getTag<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    holder<span class="token punctuation">.</span>titleTextview<span class="token punctuation">.</span><span class="token function">setText<span class="token punctuation">(</span></span>newsItem<span class="token punctuation">.</span><span class="token function">getNewstitle<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    holder<span class="token punctuation">.</span>timeTextview<span class="token punctuation">.</span><span class="token function">setText<span class="token punctuation">(</span></span>newsItem<span class="token punctuation">.</span><span class="token function">getNewstime<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> convertView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ViewHolder</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> TextView titleTextview<span class="token punctuation">;</span>
    <span class="token keyword">public</span> TextView timeTextview<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token punctuation">}</span>

</code><p><code class=" language-java"></code></p></pre>这样就可以通过adapter的构造方法来填充自己的数据。
<pre class=" language-java"><code class=" language-java">mAdapter<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">NewsAdapter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getActivity<span class="token punctuation">(</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>mNewsList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>这样，就可以实现ListView的效果了。 <p></p>

<p>reference：<a href="http://blog.csdn.net/futureshine1/article/details/50822605">http://blog.csdn.net/futureshine1/article/details/50822605</a></p>

<p>更多博客尽在：<a href="http://bboylin.com">bboylin.com</a></p>
<!-- content end -->
</div>
<br>
<br>
    <div id="disqus_thread"></div>
	<div class="footer">
		<p>© Copyright 2014 by isnowfy, Designed by isnowfy</p>
	</div>
</div>
<script src="main.js"></script>
<script id="content" type="text/mustache">
    <h1>{{title}}</h1>
    <div class="tag">
    {{date}}
    {{#tags}}
    <a href="/#/tag/{{name}}">#{{name}}</a>
    {{/tags}}
    </div>
</script>
<script id="pagesTemplate" type="text/mustache">
    {{#pages}}
    <li>
        <a href="{{path}}">{{title}}</a>
    </li>
    {{/pages}}
</script>
<script>
$(document).ready(function() {
    $.ajax({
        url: "main.json",
        type: "GET",
        dataType: "json",
        success: function(data) {
            $("#title").html(data.name);
            var pagesTemplate = Hogan.compile($("#pagesTemplate").html());
            var pagesHtml = pagesTemplate.render({"pages": data.pages});
            $("#pages").append(pagesHtml);
            //path
            var path = "viewholder.html";
            //path end
            var now = 0;
            for (var i = 0; i < data.posts.length; ++i)
                if (path == data.posts[i].path)
                    now = i;
            var post = data.posts[now];
            var tmp = post.tags.split(" ");
            var tags = [];
            for (var i = 0; i < tmp.length; ++i)
                if (tmp[i].length > 0)
                    tags.push({"name": tmp[i]});
            var contentTemplate = Hogan.compile($("#content").html());
            var contentHtml = contentTemplate.render({"title": post.title, "tags": tags, "date": post.date});
            $("#main").prepend(contentHtml);
            if (data.disqus_shortname.length > 0) {
                var disqus_shortname = data.disqus_shortname;
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            }
        }
    });
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ["\\(", "\\)"]], processEscapes: true}});
</script>
</body>
</html>
